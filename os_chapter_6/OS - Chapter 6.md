# ๐ ูุตู 6: ุงุจุฒุงุฑูุง ููโุฒูุงูโุณุงุฒ (Synchronization Tools)

ุฏุฑ ุณุณุชูโูุง ฺูุฏูพุฑุฏุงุฒูโุงุ ูพุฑุฏุงุฒูโูุง ู ูุฎโูุง ุงุบูุจ ูุงุฒ ุฏุงุฑูุฏ ุจู ุฏุงุฏูโูุง ูุดุชุฑฺฉ ุฏุณุชุฑุณ ูพุฏุง ฺฉููุฏ. ุงฺฏุฑ ุงู ุฏุณุชุฑุณ ุจูโุฏุฑุณุช ูุฏุฑุช ูุดูุฏุ ููุฌุฑ ุจู **ุดุฑุงุท ุฑูุงุจุช (Race Conditions)** ู ุฑูุชุงุฑูุง ูพุดโุจูโูุงูพุฐุฑ ุฎูุงูุฏ ุดุฏ. ุฏุฑ ุงู ูุตู ุงุจุฒุงุฑูุง ุจุฑุง ุญู ุงู ูุณุฆูู ุจุฑุฑุณ ูโุดูุฏ.

---

## ๐งญ ููุฑุณุช ูุทุงูุจ ูุตู:

### 1. ๐งฑ Background (ูพุดโุฒููู)
- ฺุฑุง ููโุฒูุงูโุณุงุฒ ุฏุฑ ุณุณุชูโุนุงููโูุง ุถุฑูุฑ ุงุณุชุ
- ุจุฑุฑุณ ููุงูู ุงููู ูุซู Race Conditionุ Thread Interleaving ู Atomicity

---

### 2. ๐ The Critical-Section Problem (ูุณุฆูู ุจุฎุด ุจุญุฑุงู)
- ูุฑ ูพุฑุฏุงุฒู ุฏุงุฑุง ุจุฎุด ุจุญุฑุงู ุงุณุช ฺฉู ุฏุฑ ุขู ุจู ููุงุจุน ูุดุชุฑฺฉ ุฏุณุชุฑุณ ุฏุงุฑุฏ.
- ูุฏู: ุทุฑุงุญ ุงูฺฏูุฑุชู ฺฉู **ุงูุญุตุงุฑ ูุชูุงุจู (Mutual Exclusion)** ุฑุง ุชุถูู ฺฉูุฏ.
- ุจุฑุฑุณ ุดุฑุงุท ูุงุฒู:
  - Mutual Exclusion
  - Progress
  - Bounded Waiting

---

### 3. ๐ Petersonโs Solution (ุฑุงูโุญู ูพุชุฑุณูู)
- ฺฉ ุฑุงูโุญู ูุฑูโุงูุฒุงุฑ ฺฉูุงุณฺฉ ุจุฑุง ุฏู ูพุฑุฏุงุฒู.
- ุงุณุชูุงุฏู ุงุฒ ูุชุบุฑูุง ุงุดุชุฑุงฺฉ ูุงููุฏ `flag[]` ู `turn`

---

### 4. ๐งฎ Hardware Support for Synchronization (ูพุดุชุจุงู ุณุฎุชโุงูุฒุงุฑ)
- ุฏุณุชูุฑูุง ุงุชู ุณุทุญ ูพุงู ูุงููุฏ:
  - TestAndSet
  - Swap
  - CompareAndSwap
- ุจุฑุฑุณ ูุฒุงุง ู ูุญุฏูุฏุชโูุง

---

### 5. ๐งฉ Mutex Locks (ูููโูุง ูุชูุงุจู)
- ุณุงุฏูโุชุฑู ุงุจุฒุงุฑ ุจุฑุง ฺฉูุชุฑู ุฏุณุชุฑุณ ูุชูุงุจู
- ุดุงูู ุชูุงุจุน `lock()` ู `unlock()`
- ูุนุฑู ููููู busy waiting

---

### 6. โ๏ธ Semaphores (ุณูุงููุฑูุง)
- ุงุจุฒุงุฑ ูุฏุฑุชููุฏ ู ุนููู ุจุฑุง ููโุฒูุงูโุณุงุฒ
- ุฏู ููุน:
  - Counting Semaphore
  - Binary Semaphore (ูุนุงุฏู Mutex)
- ุชูุงุจุน `wait()` ู `signal()`
- ุฎุทุฑุงุช: deadlock ู starvation

---

### 7. ๐ฎโโ๏ธ Monitors (ูุธุงุฑุชโฺฏุฑูุง)
- ุณุงุฎุชุงุฑ ุณุทุญ ุจุงูุง ุจุฑุง ููโุฒูุงูโุณุงุฒ ุฏุฑ ุฒุจุงูโูุง ุจุฑูุงููโููุณ
- ุชุณููโฺฉููุฏูโ ูุฏุฑุช ููุงุจุน ุงุดุชุฑุงฺฉ ุจุฏูู ูุฏุฑุช ุตุฑุญ ูููโูุง ุชูุณุท ุจุฑูุงููโููุณ

---

### 8. ๐งฌ Liveness (ุฒูุฏูโูุงู)
- ุจุฑุฑุณ ูุดฺฉูุงุช ูุงููุฏ:
  - Deadlock (ุจูโุจุณุช)
  - Starvation (ูุญุท)
  - Bounded Waiting (ูุญุฏูุฏุช ุงูุชุธุงุฑ)

---

### 9. ๐ Evaluation (ุงุฑุฒุงุจ ููุง)
- ููุงุณู ุงุจุฒุงุฑูุง ูุฎุชูู ุงุฒ ูุธุฑ:
  - ุณุงุฏฺฏ ูพุงุฏูโุณุงุฒ
  - ฺฉุงุฑุง
  - ูุงุจูุช ุงุทููุงู
  - ุชุทุจูโูพุฐุฑ ุจุง ุณุณุชูโูุง ฺูุฏูพุฑุฏุงุฒูโุง

---

## โ ูุฏู ฺฉู ูุตู:

> ุขุดูุง ุจุง ุงุจุฒุงุฑูุง ู ุชฺฉูฺฉโูุง ุจุฑุง ุชุถูู **ุงุฌุฑุง ุงูู ู ูุงุจู ูพุดโุจู** ุจุฑูุงููโูุง ุฏุฑ ูุญุทโูุง ููโุฒูุงู ู ฺูุฏูุฎ (Multithreaded).

---
# ๐ฏ ุงูุฏุงู ูุตู 6: ุงุจุฒุงุฑูุง ููโุฒูุงูโุณุงุฒ (Synchronization Tools)

ุงู ูุตู ุจู ุจุฑุฑุณ ุงุจุฒุงุฑูุง ู ุชฺฉูฺฉโูุง ููู ูโูพุฑุฏุงุฒุฏ ฺฉู ุจุฑุง ูุฏุฑุช ููโุฒูุงู (Synchronization) ุฏุฑ ุณุณุชูโูุง ฺูุฏูุฎ ุง ฺูุฏูพุฑุฏุงุฒูโุง ุงุณุชูุงุฏู ูโุดููุฏ. ุงูุฏุงู ุงุตู ูุตู ุจู ุดุฑุญ ุฒุฑ ุงุณุช:

---

## 1. ๐งฉ ุชูุตู ูุณุฆููโ **Critical Section** ู ุดุฑุงุท ุฑูุงุจุช

- ุชุนุฑู **Critical Section**: ุจุฎุด ุงุฒ ฺฉุฏ ฺฉู ุฏุฑ ุขู ูพุฑุฏุงุฒู ุจู **ููุงุจุน ุงุดุชุฑุงฺฉ** (ูุซู ุญุงูุธู ุง ูุงู) ุฏุณุชุฑุณ ุฏุงุฑุฏ.
- ุงฺฏุฑ ฺูุฏ ูพุฑุฏุงุฒู ููโุฒูุงู ุจู ุงู ููุงุจุน ุฏุณุชุฑุณ ูพุฏุง ฺฉููุฏุ ููฺฉู ุงุณุช **Race Condition** ุฑุฎ ุฏูุฏ.
- Race Condition ุจุงุนุซ ุฑูุชุงุฑูุง ูุงุณุงุฒฺฏุงุฑุ ุฏุงุฏูโูุง ูุงูุต ุง ุฎุฑูุฌ ูุงุฏุฑุณุช ูโุดูุฏ.

> ๐ฏ ูุฏู: ุงุทููุงู ุงุฒ ุงูฺฉู ุฏุฑ ูุฑ ูุญุธู ููุท **ฺฉ ูพุฑุฏุงุฒู ุฏุฑ ุจุฎุด ุจุญุฑุงู** ูุฑุงุฑ ุฏุงุฑุฏ.

---

## 2. โ๏ธ ููุงุด ุฑุงูโุญูโูุง ุณุฎุชโุงูุฒุงุฑ

- ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑูุง ุณุทุญ ูพุงู ุจุฑุง ฺฉูุชุฑู ุงุชู ุจูุฏู ุนููุงุช:
  - **Memory Barriers** (ููุงูุน ุญุงูุธู)
  - **Compare-and-Swap**
  - **Atomic Variables**
  
> โ ุงู ุงุจุฒุงุฑูุง ุงุบูุจ ุชูุณุท ุฒุจุงูโูุง ุณุทุญ ุจุงูุง ุง ุณุณุชูโุนุงููโูุง ุจุฑุง ุณุงุฎุช ุงุจุฒุงุฑูุง ููโุฒูุงูโุณุงุฒ ุงุณุชูุงุฏู ูโุดููุฏ.

---

## 3. ๐ ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑูุง ููโุฒูุงูโุณุงุฒ ุจุฑุง ุญู ูุณุฆูู:

- **Mutex Locks**: ูููโูุง ุณุงุฏู ุจุฑุง ูุฑูุฏ ู ุฎุฑูุฌ ุงุฒ ุจุฎุด ุจุญุฑุงู.
- **Semaphores**: ุงุจุฒุงุฑ ุนูููโุชุฑ ฺฉู ูโุชูุงููุฏ ููุงุจุน ุดูุงุฑุด ุฑุง ฺฉูุชุฑู ฺฉููุฏ.
- **Monitors**: ุณุงุฎุชุงุฑ ุณุทุญ ุจุงูุง ฺฉู ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ูููโูุง ู ุดุฑุงุท ุฑุง ูุฏุฑุช ูโฺฉูุฏ.
- **Condition Variables**: ูฺฉุงูุฒูโูุง ุจุฑุง ููฺฏุงูโุณุงุฒ ุจุง ูุถุนุช ูุดุฎุต (ูุซูุงู ุงูุชุธุงุฑ ุจุฑุง ุฑุฎุฏุงุฏ ฺฉ ุดุฑุท ุฎุงุต)

> ๐ ูุฑ ฺฉ ุงุฒ ุงู ุงุจุฒุงุฑูุง ูโุชูุงูุฏ ุฏุฑ ุณูุงุฑููุง ุฎุงุต ูุคุซุฑุชุฑ ุจุงุดุฏ.

---

## 4. ๐ ุงุฑุฒุงุจ ุงุจุฒุงุฑูุง ุฏุฑ ุณูุงุฑููุง ูุฎุชูู

- **Low Contention**: ุชุนุฏุงุฏ ฺฉู ุงุฒ ูพุฑุฏุงุฒูโูุง ููโุฒูุงู ุจู ููุจุน ุฏุณุชุฑุณ ุฏุงุฑูุฏ.
- **Moderate Contention**: ุฑูุงุจุช ูุชูุณุท ุจุฑุง ุฏุณุชุฑุณ ุจู ููุงุจุน.
- **High Contention**: ุฑูุงุจุช ุดุฏุฏ ูุงู ูพุฑุฏุงุฒูโูุงุ ูุงููุฏ ุณุฑูุฑูุง ฺูุฏูุฎ ุจุง ุจุงุฑ ุณูฺฏู.

> ๐ฏ ุงูุชุฎุงุจ ุงุจุฒุงุฑ ููุงุณุจ ุจุง ุชูุฌู ุจู ูุฒุงู ุฑูุงุจุช ุจู ูพุฑุฏุงุฒูโูุง ุจุณุงุฑ ุญุงุช ุงุณุช.

---

## ๐งพ ูุชุฌูโฺฏุฑ:

ุงู ูุตู ุจู ุดูุง ฺฉูฺฉ ูโฺฉูุฏ ุชุง:

- ุฏุฑฺฉ ุนูู ุงุฒ **ูุดฺฉูุงุช ููโุฒูุงู** ูพุฏุง ฺฉูุฏุ
- ุงุจุฒุงุฑูุง **ุณุณุชูโุนุงูู ู ุณุฎุชโุงูุฒุงุฑ** ูุงุฒู ุจุฑุง ูุฏุฑุช ุขู ุฑุง ุจุงููุฒุฏุ
- ู ุฏุฑ ููุงุชุ ุฑุงูโุญูโูุง **ููุงุณุจ ุจุง ุดุฑุงุท ุฑูุงุจุช ูุชูุงูุช** ุฑุง ุชุญูู ู ุงูุชุฎุงุจ ฺฉูุฏ.
---
# ๐ ูพุดโุฒููู (Background)

ุฏุฑ ุณุณุชูโุนุงููโูุง ฺฉู ุงุฒ ฺูุฏูุฎ ุง ฺูุฏูพุฑุฏุงุฒูโุง ูพุดุชุจุงู ูโฺฉููุฏุ ุงูฺฉุงู ุงุฌุฑุง ููโุฒูุงู (Concurrency) ุจุฑุง ฺูุฏู ูพุฑุฏุงุฒู ุง ูุฎ ูุฌูุฏ ุฏุงุฑุฏ. ุงู ูฺฺฏ ูุฒุงุง ุฏุงุฑุฏ ุงูุง ฺุงูุดโูุง ูุฒ ุจู ููุฑุงู ูโุขูุฑุฏ.

---

## โ๏ธ ุงุฌุฑุง ููโุฒูุงู ูพุฑุฏุงุฒูโูุง

- ูพุฑุฏุงุฒูโูุง ูโุชูุงููุฏ **ุจูโุตูุฑุช ููโุฒูุงู ุงุฌุฑุง ุดููุฏ**.
- ุณุณุชูโุนุงูู ููฺฉู ุงุณุช **ูุฑ ูุญุธู ฺฉ ุงุฒ ุขูโูุง ุฑุง ูุชููู** ฺฉูุฏ (interrupt)ุ ุญุช ุฒูุงู ฺฉู ุงุฌุฑุง ุขู ูููุฒ ฺฉุงูู ูุดุฏู ุงุณุช.
- ุจูุงุจุฑุงูุ ููฺฉู ุงุณุช ุนููุงุช ูุงุชูุงู ุฑู ููุงุจุน ุงุดุชุฑุงฺฉ ุจูุงูุฏ.

---

## โ๏ธ ูุดฺฉู ุฏุณุชุฑุณ ููโุฒูุงู ุจู ุฏุงุฏูโูุง ูุดุชุฑฺฉ

- ุฒูุงู ฺฉู ฺูุฏ ูพุฑุฏุงุฒู ุจู **ุฏุงุฏูโุง ูุดุชุฑฺฉ** (ูุซู ูุชุบุฑุ ุจุงูุฑุ ูุงู) ุฏุณุชุฑุณ ููโุฒูุงู ุฏุงุฑูุฏุ ููฺฉู ุงุณุช ุฏุงุฏูโูุง ุฏฺุงุฑ **ูุงููโุฎูุงู (Inconsistency)** ุดููุฏ.
- ุงู ูุดฺฉู ุฒูุงู ุฑุฎ ูโุฏูุฏ ฺฉู ุนููุงุช ุฎูุงูุฏู/ููุดุชู ุชูุณุท ูพุฑุฏุงุฒูโูุง ุจูโุตูุฑุช **ุจูุงุจู (Interleaved)** ุงูุฌุงู ุดูุฏ.

---

## ๐ก๏ธ ูุงุฒ ุจู ููุงููฺฏ

ุจุฑุง ุญูุธ **ุณุงุฒฺฏุงุฑ ุฏุงุฏูโูุง (Data Consistency)**ุ ุณุณุชู ุจุงุฏ ูฺฉุงูุฒูโูุง ูุฑุงูู ฺฉูุฏ ฺฉู:

- **ุชุฑุชุจ ุงุฌุฑุง ูพุฑุฏุงุฒูโูุง ูุงุจุณุชู ุจู ฺฉุฏฺฏุฑ** ุญูุธ ุดูุฏ.
- ูพุฑุฏุงุฒูโูุง ุฏุฑ ููฺฏุงู ุฏุณุชุฑุณ ุจู ููุงุจุน ุงุดุชุฑุงฺฉุ ุชุฏุงุฎู ุงุฌุงุฏ ูฺฉููุฏ.

---

## ๐งช ูุซุงู: ูุณุฆูู ุจุงูุฑ ูุญุฏูุฏ (Bounded Buffer Problem)

- ุฏุฑ ูุตู 4 ุงู ูุดฺฉู ุฑุง ุฏุฏู:
  - **ุชููุฏฺฉููุฏู (Producer)** ู **ูุตุฑูโฺฉููุฏู (Consumer)** ุจูโุตูุฑุช ููโุฒูุงู ุจู ฺฉ **ุดูุงุฑูุฏู ูุดุชุฑฺฉ (counter)** ุฏุณุชุฑุณ ุฏุงุดุชูุฏ.
  - ูุฑ ุฏู ูพุฑุฏุงุฒู ุงู ุดูุงุฑูุฏู ุฑุง ุจูโุฑูุฒุฑุณุงู ูโฺฉุฑุฏูุฏ.
  - ฺูู ุงู ุนููุงุช **ุงุชู (Atomic)** ูุจูุฏุ ฺฏุงู ุจูโุฌุง ุงูุฒุงุด ุง ฺฉุงูุด ุฏุฑุณุชุ ููุฏุงุฑ ุขู **ูุงููโุฎูุงู (Race Condition)** ูโุดุฏ.

> ๐ฏ ูุชุฌู: ุฏุณุชุฑุณ ููโุฒูุงู ุจุฏูู ููุงููฺฏ โ ุฑูุชุงุฑ ูุงุฏุฑุณุช ู ุบุฑูุงุจู ูพุดโุจู

---

## ๐ ุฌูุนโุจูุฏ

> ุฏุฑ ุณุณุชูโูุง ฺูุฏูุฎ ุง ฺูุฏูพุฑุฏุงุฒูโุงุ ุจุฏูู ฺฉูุชุฑู ููุงุณุจุ ุฏุณุชุฑุณ ููโุฒูุงู ุจู ุฏุงุฏูโูุง ูุดุชุฑฺฉ ูโุชูุงูุฏ ููุฌุฑ ุจู **ุดุฑุงุท ุฑูุงุจุช** ุดูุฏ.  
> ุจูุงุจุฑุงูุ ูุงุฒ ุจู ุงุจุฒุงุฑูุง ุจุฑุง **ููโุฒูุงูโุณุงุฒ ู ุชุฑุชุจโุฏู ุงุฌุฑุง ูพุฑุฏุงุฒูโูุง** ุฏุงุฑู.

---
# โ๏ธ Race Condition ุฏุฑ Producer/Consumer

## ๐ท ฺฉุฏ ุชููุฏฺฉููุฏู (Producer)

```c
while (true) {
    /* produce an item in next_produced */
    while (counter == BUFFER_SIZE) ;  // ุจุงูุฑ ูพุฑ ุงุณุชุ ุตุจุฑ ฺฉู
    buffer[in] = next_produced;
    in = (in + 1) % BUFFER_SIZE;
    counter++;  // ๐ด ุงูุฒุงุด ุดูุงุฑูุฏู
}
````

---

## ๐งโโ๏ธ ฺฉุฏ ูุตุฑูโฺฉููุฏู (Consumer)

```c
while (true) {
    while (counter == 0) ;  // ุจุงูุฑ ุฎุงู ุงุณุชุ ุตุจุฑ ฺฉู
    next_consumed = buffer[out];
    out = (out + 1) % BUFFER_SIZE;
    counter--;  // ๐ด ฺฉุงูุด ุดูุงุฑูุฏู
    /* consume the item in next_consumed */
}
```

---

## ๐งฌ ูุณุฆูู ุงุตู: ุจูโุฑูุฒุฑุณุงู ููโุฒูุงู ูุชุบุฑ `counter`

- ูุชุบุฑ `counter` ุชูุณุท ูุฑ ุฏู ูพุฑุฏุงุฒู (ุชููุฏฺฉููุฏู ู ูุตุฑูโฺฉููุฏู) ุจูโุตูุฑุช ููโุฒูุงู ู ุจุฏูู ููุงููฺฏ ุชุบุฑ ูโฺฉูุฏ.
    
- ุนููุงุช `counter++` ู `counter--` ุฏุฑ ุธุงูุฑ ฺฉ ุฎุท ูุณุชูุฏุ ุงูุง ุฏุฑ ูุงูุน ุจู ฺูุฏ **ูุฑุญููโ ุฏุงุฎู** ุฏุฑ ุณุทุญ ุณุฎุชโุงูุฒุงุฑ ุดฺฉุณุชู ูโุดููุฏ.
    

---

## โ๏ธ ูุญูู ุนููฺฉุฑุฏ ุฏุงุฎู ุนููุงุชโูุง:

### ๐ผ ุงูุฒุงุด (`counter++`)

```asm
register1 = counter
register1 = register1 + 1
counter = register1
```

### ๐ฝ ฺฉุงูุด (`counter--`)

```asm
register2 = counter
register2 = register2 - 1
counter = register2
```

---

## ๐งช ูุซุงู ุงุฒ ุชุฏุงุฎู ุงุฌุฑุง ุชููุฏฺฉููุฏู ู ูุตุฑูโฺฉููุฏู:

ูุฑุถ ฺฉูู ููุฏุงุฑ ุงููู `counter = 5` ุงุณุช ู ูพุฑุฏุงุฒูโูุง ุจูโุตูุฑุช ุฒุฑ ุงุฌุฑุง ุดููุฏ:

|ฺฏุงู|ุนููุงุช|ุชูุถุญ|
|---|---|---|
|S0|Producer โ `register1 = counter`|register1 = 5|
|S1|Producer โ `register1 = register1 + 1`|register1 = 6|
|S2|Consumer โ `register2 = counter`|register2 = 5|
|S3|Consumer โ `register2 = register2 - 1`|register2 = 4|
|S4|Producer โ `counter = register1`|counter = 6 (ุฏุฑ ุธุงูุฑ ุฏุฑุณุช ุงุณุช)|
|S5|Consumer โ `counter = register2`|โ counter = 4 (ุงุดุชุจุงู!)|

---

## โ ูุชุฌู: ุจุฑูุฒ ุดุฑุงุท ุฑูุงุจุช (Race Condition)

> ูุฑ ุฏู ูพุฑุฏุงุฒู ูฺฉุฑ ูโฺฉููุฏ ุนููุงุช ุฎูุฏ ุฑุง ุฏุฑุณุช ุงูุฌุงู ุฏุงุฏูโุงูุฏุ ุงูุง ููุฏุงุฑ ููุง `counter` ูุงุฏุฑุณุช ุงุณุช ู ููุฌุฑ ุจู ุงุฎุชูุงู ุฏุฑ ููุทู ุจุฑูุงูู ูโุดูุฏ.

---

## โ ุฑุงูโุญู ฺุณุชุ

ุจุฑุง ุฌููฺฏุฑ ุงุฒ ฺูู ูุถุนุช ุจุงุฏ:

- ุจุฎุดโูุง ุงุฒ ฺฉุฏ ฺฉู ุจู ุฏุงุฏูโูุง ูุดุชุฑฺฉ ุฏุณุชุฑุณ ุฏุงุฑูุฏุ ุฏุฑ **ุจุฎุด ุจุญุฑุงู (Critical Section)** ูุฑุงุฑ ฺฏุฑูุฏ.
    
- ุงุฒ ุงุจุฒุงุฑูุง ูุงููุฏ:
    
    - Mutex Lock
        
    - Semaphore
        
    - Monitor  
        ุงุณุชูุงุฏู ุดูุฏ ุชุง ุฏุฑ ูุฑ ูุญุธู ููุท **ฺฉ ูพุฑุฏุงุฒู** ุจู ุขู ุจุฎุด ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ.
        
---

# โ๏ธ Race Condition ุฏุฑ ูุฑุงุฎูุงู fork()

ุฏุฑ ุงู ูุซุงูุ ุดุฑุงุท ุฑูุงุจุช (Race Condition) ุฏุฑ ุฒูุงู ุณุงุฎุช ูุฑุขูุฏูุง ูุฑุฒูุฏ ุชูุณุท ฺูุฏ ูพุฑุฏุงุฒู ููโุฒูุงู ุจุฑุฑุณ ูโุดูุฏ.

---

## ๐ง ูุถุนุช ูุณุฆูู

- ุฏู ูพุฑุฏุงุฒู ุจู ูุงูโูุง `Pโ` ู `Pโ` ุจูโุทูุฑ ููโุฒูุงู ุงุฒ ุชุงุจุน ุณุณุชู `fork()` ุจุฑุง ุงุฌุงุฏ ูุฑุฒูุฏ ุงุณุชูุงุฏู ูโฺฉููุฏ.
- ูุณุชู ุณุณุชูโุนุงูู (Kernel) ุงุฒ ูุชุบุฑ **`next_available_pid`** ุจุฑุง ุชุฎุตุต ุดูุงุณู ูพุฑุฏุงุฒู (PID) ุฌุฏุฏ ุงุณุชูุงุฏู ูโฺฉูุฏ.
- ุงู ูุชุบุฑ **ุงุดุชุฑุงฺฉ** ุงุณุช ู ุงฺฏุฑ ููโุฒูุงู ุชูุณุท ฺูุฏ ูพุฑุฏุงุฒู ุงุณุชูุงุฏู ุดูุฏุ ููุฌุฑ ุจู ุชุฎุตุต **PID ุชฺฉุฑุงุฑ** ูโุดูุฏ.

---

## ๐งช ุชุฑุชุจ ูููุน ูุดฺฉู

### ูุฑุถ: ููุฏุงุฑ ุงููู `next_available_pid = 2615`

| ุฒูุงู | ูพุฑุฏุงุฒู `Pโ`                     | ูพุฑุฏุงุฒู `Pโ`                     |
|------|----------------------------------|----------------------------------|
| tโ   | ุฏุฑุฎูุงุณุช PID ูโุฏูุฏ               |                                  |
| tโ   | `next_available_pid = 2615`      |                                  |
| tโ   |                                  | ุฏุฑุฎูุงุณุช PID ูโุฏูุฏ               |
| tโ   |                                  | `next_available_pid = 2615`      |
| tโ   | PID = 2615 ุจู `Pโ` ุฏุงุฏู ูโุดูุฏ   | PID = 2615 ุจู `Pโ` ุฏุงุฏู ูโุดูุฏ   |

๐ฏ ุฏุฑ ูุชุฌูุ **ูุฑ ุฏู ูพุฑุฏุงุฒูุ ฺฉ PID ฺฉุณุงู (2615)** ุจู ูุฑุฒูุฏุงู ุฎูุฏ ุงุฎุชุตุงุต ูโุฏููุฏุ ฺฉู **ุบุฑูุฌุงุฒ ู ุฎุทุฑูุงฺฉ** ุงุณุช.

---

## โ ูพุงูุฏ

> ุงฺฏุฑ ูฺฉุงูุฒู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฏุณุชุฑุณ ููโุฒูุงู `Pโ` ู `Pโ` ุจู `next_available_pid` ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ููฺฉู ุงุณุช ุฏู ูพุฑุฏุงุฒู ูุฎุชูู PID ฺฉุณุงู ุฏุฑุงูุช ฺฉููุฏ.

---

## โ ุฑุงูโุญู

ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงู ุดุฑุงุท ุฑูุงุจุชุ ุจุงุฏ:

- ุงุฒ ุงุจุฒุงุฑูุง **ููโุฒูุงูโุณุงุฒ ุฏุฑ ุณุทุญ ูุณุชู (Kernel Synchronization)** ูุงููุฏ:
  - ูููโูุง ฺุฑุฎุด (Spinlocks)
  - Semaphores ุฏุฑ ฺฉุฑูู
  - ุนููุงุช ุงุชู (Atomic Instructions)
  ุงุณุชูุงุฏู ุดูุฏ.

---

## ๐ ูููุฏุงุฑ ุชุฑุชุจ ุฒูุงู ุงุฌุฑุง ุนููุงุช (Mermaid)

![[Pasted image 20250513170822.png]]

---

## ๐งพ ุฌูุนโุจูุฏ

> ุจุฑุง ูุฑ ููุจุน ูุดุชุฑฺฉ ุฏุฑ ุณุณุชูโุนุงูู (ูุซู `next_available_pid`) ุจุงุฏ ุฏุณุชุฑุณ ููโุฒูุงู ฺฉูุชุฑู ุดูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ููฺฉู ุงุณุช ูุถุนุช ุจุญุฑุงู ู ูุงูพุงุฏุงุฑ ุจูโูุฌูุฏ ุขุฏ.

---

# ๐ ูุณุฆูู ุจุฎุด ุจุญุฑุงู (Critical Section Problem)

---

## ๐งฉ ุชุนุฑู ูุณุฆูู

ุฏุฑ ฺฉ ุณุณุชู ุจุง ฺูุฏ ูพุฑุฏุงุฒู ููโุฒูุงู:

```

Pโ, Pโ, Pโ, ..., Pโโโ

```

ูุฑ ูพุฑุฏุงุฒู ููฺฉู ุงุณุช ุฏุงุฑุง ุจุฎุด ุงุฒ ฺฉุฏ ุจุงุดุฏ ฺฉู ุฏุฑ ุขู ุจุง ููุงุจุน **ูุดุชุฑฺฉ** ฺฉุงุฑ ูโฺฉูุฏ:

- ุชุบุฑ ููุฏุงุฑ ูุชุบุฑูุง ูุดุชุฑฺฉ
- ููุดุชู ุฏุฑ ูุงูโูุง
- ุจูโุฑูุฒุฑุณุงู ุฌุฏุงูู ุญุงูุธู ุง ุงุดุชุฑุงฺฉ

ุงู ุจุฎุดโูุง ุฑุง **ุจุฎุด ุจุญุฑุงู (Critical Section)** ูโูุงูู.

---

## ๐จ ูุงููู ุงุตู ุจุฎุด ุจุญุฑุงู

> ุฏุฑ ูุฑ ูุญุธู **ููุท ฺฉ ูพุฑุฏุงุฒู** ูุฌุงุฒ ุจู ูุฑูุฏ ุจู ุจุฎุด ุจุญุฑุงู ุงุณุช.

ุนู ุงฺฏุฑ ูพุฑุฏุงุฒูโุง ุฏุงุฎู ุจุฎุด ุจุญุฑุงู ุงุณุชุ ูพุฑุฏุงุฒูโูุง ุฏฺฏุฑ ุจุงุฏ ุตุจุฑ ฺฉููุฏ ุชุง ุงุฒ ุขู ุฎุงุฑุฌ ุดูุฏ.

---

## ๐ง ูุฏู ูุณุฆูู

ูุฏู ุงุตู ุงู ูุณุฆูู ุทุฑุงุญ **ูพุฑูุชฺฉู** ุงุณุช ฺฉู ุณู ุดุฑุท ุฑุง ูุฑุงูู ฺฉูุฏ:

1. โ **Mutual Exclusion (ๆโูุงูุน ุจูุฏู)**: ููุท ฺฉ ูพุฑุฏุงุฒู ุฏุฑ ูุฑ ุฒูุงู ูโุชูุงูุฏ ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดูุฏ.
2. ๐ **Progress (ูพุดุฑูุช)**: ุงฺฏุฑ ูฺ ูพุฑุฏุงุฒูโุง ุฏุฑ ุจุฎุด ุจุญุฑุงู ูุณุชุ ุจุงุฏ ุงูฺฉุงู ูุฑูุฏ ุจุฑุง ฺฉ ุงุฒ ูพุฑุฏุงุฒูโูุง ููุชุธุฑ ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ.
3. โป๏ธ **Bounded Waiting (ุงูุชุธุงุฑ ูุญุฏูุฏ)**: ูุฑ ูพุฑุฏุงุฒูโุง ฺฉู ุฏุฑุฎูุงุณุช ูุฑูุฏ ุจู ุจุฎุด ุจุญุฑุงู ุฏุงุฑุฏุ ุจุงุฏ ุฏุฑ ุฒูุงู ูุญุฏูุฏ ุจุชูุงูุฏ ูุงุฑุฏ ุดูุฏ (ฺฏุฑู ูุฎูุฑุฏ!).

---

## ๐งฑ ุณุงุฎุชุงุฑ ฺฉู ุงุฌุฑุง ูพุฑุฏุงุฒู

ฺฉุฏ ูุฑ ูพุฑุฏุงุฒู ุจู ฺูุงุฑ ุจุฎุด ุชูุณู ูโุดูุฏ:

```

while (true) {  
Entry Section // ุฏุฑุฎูุงุณุช ูุฑูุฏ ุจู ุจุฎุด ุจุญุฑุงู  
Critical Section // ุจุฎุด ุจุญุฑุงู: ุฏุณุชุฑุณ ุจู ููุงุจุน ูุดุชุฑฺฉ  
Exit Section // ุฎุฑูุฌ ู ุขุฒุงุฏุณุงุฒ ููุงุจุน  
Remainder Section // ุจูู ฺฉุฏ ูพุฑุฏุงุฒู  
}

```

---

## ๐ ุฌูุนโุจูุฏ

> ูุณุฆูู ุจุฎุด ุจุญุฑุงู ฺฉ ุงุฒ ูููโุชุฑู ููุงูู ุฏุฑ ุทุฑุงุญ ุณุณุชูโูุง ุนุงูู ู ุจุฑูุงููโูุง ฺูุฏูุฎ ุงุณุช.  
> ุฑุงูโุญูโูุง ูุชููุน ุจุฑุง ุญู ุงู ูุณุฆูู ุงุฑุงุฆู ุดุฏูโุงูุฏ ฺฉู ุดุงูู **ุฑุงูโุญูโูุง ูุฑูโุงูุฒุงุฑุ ุณุฎุชโุงูุฒุงุฑุ ู ุงุจุฒุงุฑูุง ููโุฒูุงูโุณุงุฒ** ูุซู Mutexุ Semaphoreุ ู Monitor ูโุดูุฏ.

---
# ๐ Critical Section โ ุณุงุฎุชุงุฑ ู ุดุฑุงุท ุญู ูุณุฆูู

---

## ๐งฑ ุณุงุฎุชุงุฑ ุนููู ฺฉ ูพุฑุฏุงุฒู Pi

ูุฑ ูพุฑุฏุงุฒูโุง ฺฉู ุฏุฑ ุณุณุชู ููโุฒูุงู ุงุฌุฑุง ูโุดูุฏุ ูุนูููุง ุจู ุตูุฑุช ฺฉ ุญููู ุจโููุงุช ุงุณุช ฺฉู ุดุงูู ฺูุงุฑ ุจุฎุด ุงุตู ุงุณุช:

```cpp
while (true) {
    entry section       // ูุฑูุฏ ู ุจุฑุฑุณ ุดุฑุงุท ุจุฎุด ุจุญุฑุงู
    critical section    // ฺฉุฏ ูุฑุจูุท ุจู ููุงุจุน ูุดุชุฑฺฉ
    exit section        // ุฎุฑูุฌ ู ุขุฒุงุฏุณุงุฒ ููุงุจุน
    remainder section   // ุจูู ุจุฑูุงูู
}
````

---

## ๐ฏ ูุฏู ูุณุฆูู ุจุฎุด ุจุญุฑุงู

ูุฏูุ ุทุฑุงุญ ฺฉ **ูพุฑูุชฺฉู ููุงููฺฏโฺฉููุฏู** ุงุณุช ฺฉู ุจู ูพุฑุฏุงุฒูโูุง ุงุฌุงุฒู ุฏูุฏ ุจู ุดฺฉู ุงูู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดููุฏุ ุจุฏูู ุชุฏุงุฎู ุจุง ูพุฑุฏุงุฒูโูุง ุฏฺฏุฑ.

---

## โ ุดุฑุงุท ูุงุฒู ุจุฑุง ฺฉ ุฑุงูโุญู ุฏุฑุณุช

### 1. **Mutual Exclusion (ๆโูุงูุน ุจูุฏู)**

ุงฺฏุฑ ูพุฑุฏุงุฒู `Pแตข` ุฏุฑ ุญุงู ุงุฌุฑุง ุฏุฑ ุจุฎุด ุจุญุฑุงู ุจุงุดุฏุ ูฺ ูพุฑุฏุงุฒูโุง ูุจุงุฏ ุฏุฑ ููุงู ุฒูุงู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดูุฏ.

---

### 2. **Progress (ูพุดุฑูุช)**

ุงฺฏุฑ ูฺ ูพุฑุฏุงุฒูโุง ุฏุงุฎู ุจุฎุด ุจุญุฑุงู ูุจุงุดุฏ ู ุจุฑุฎ ูพุฑุฏุงุฒูโูุง ูุงู ุจู ูุฑูุฏ ุจุงุดูุฏุ ุงูุชุฎุงุจ ฺฉ ุงุฒ ุขูโูุง ุจุฑุง ูุฑูุฏ ูุจุงุฏ ุจู ุชุฃุฎุฑ ุจโููุงุช ุจูุชุฏ.

---

### 3. **Bounded Waiting (ุงูุชุธุงุฑ ูุญุฏูุฏ)**

ุฒูุงู ฺฉู ูพุฑุฏุงุฒูโุง ุฏุฑุฎูุงุณุช ูุฑูุฏ ุจู ุจุฎุด ุจุญุฑุงู ุฑุง ูโุฏูุฏุ ุจุงุฏ **ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ูุดุฎุต** ุงุฒ ูพุฑุฏุงุฒูโูุง ูุจู ุงุฒ ุขู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดููุฏ. ุนู ูุจุงุฏ ูพุฑุฏุงุฒูโุง ุจุฑุง ููุดู ูพุดุช ุตู ุจูุงูุฏ.

---

## โ๏ธ ูุฑุถุงุช ูพุงู

- ูุฑ ูพุฑุฏุงุฒู ุฏุฑ ูุฏุช ุฒูุงู ุบุฑ ุตูุฑ ุงุฌุฑุง ูโุดูุฏ (ุนู ูุชููู ุง ููู ูุดุฏู ูุณุช).
    
- ูฺ ูุฑุถ ุฏุฑุจุงุฑู ุณุฑุนุช ูุณุจ ูพุฑุฏุงุฒูโูุง ุง ุชุฑุชุจ ุงุฌุฑุง ุขูโูุง ูุฏุงุฑู (ฺฉุงููุง ูุงุจุฑุงุจุฑ ููฺฉู ุงุณุช ุจุงุดูุฏ).
    

---

## ๐งพ ุฌูุนโุจูุฏ

> ูุฑ ูพุฑูุชฺฉู ุจุฑุง ุญู ูุณุฆูู ุจุฎุด ุจุญุฑุงู ุจุงุฏ ุงู ุณู ุดุฑุท ููู ุฑุง **ููุฒูุงู** ุจุฑูุฑุงุฑ ฺฉูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุง ููฺฉู ุงุณุช ุชุฏุงุฎู ุฏุงุฏู ุงุฌุงุฏ ุดูุฏุ ุง ุจุฑุฎ ูพุฑุฏุงุฒูโูุง ูุฑฺฏุฒ ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ูุดููุฏ (Starvation).

---
# ๐ง ุฑุงูโุญู ูุฑูโุงูุฒุงุฑ ุงูู (Software Solution 1)

---

## ๐ข ุดุฑุงุท ูุณุฆูู

- ุงู ุฑุงูโุญู ููุท ุจุฑุง **ุฏู ูพุฑุฏุงุฒู** (Pโ ู Pโ) ูุงุจู ุงุณุชูุงุฏู ุงุณุช.
- ูุฑุถ ูโุดูุฏ ฺฉู **ุฏุณุชูุฑุงุช load ู store ุงุชู ูุณุชูุฏ**ุ ุนู ุฏุฑ ูุงูู ุงุฌุฑุง ูุงุจู ูุทุนโุดุฏู ูุณุชูุฏ.

---

## ๐งฎ ูุชุบุฑ ูุดุชุฑฺฉ ุจู ูพุฑุฏุงุฒูโูุง

ูพุฑุฏุงุฒูโูุง ููุท ฺฉ ูุชุบุฑ ูุดุชุฑฺฉ ุฏุงุฑูุฏ:

```c
int turn;
````

- ููุฏุงุฑ ุงู ูุชุบุฑ ูุดุฎุต ูโฺฉูุฏ ฺฉู **ููุจุช ฺฉุฏุงู ูพุฑุฏุงุฒู** ุงุณุช ฺฉู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดูุฏ.
    
- ููุฏุงุฑ ุงููู ูุชุบุฑ ุจู `i` ุชูุธู ูโุดูุฏุ ฺฉู ูุดุงู ูโุฏูุฏ ูพุฑุฏุงุฒู `Pแตข` ุญู ูุฑูุฏ ุฏุงุฑุฏ.
    

---

## ๐ ุงูฺฏูุฑุชู ุจุฑุง ูพุฑุฏุงุฒู Pi

```c
while (true) {
    while (turn == j);        // ุฏุฑ ุตูุฑุช ฺฉู ููุจุช ูพุฑุฏุงุฒู j ุจุงุดุฏุ ููุชุธุฑ ุจูุงู
    // ุจุฎุด ุจุญุฑุงู
    turn = j;                 // ููุจุช ุฑุง ุจู ูพุฑุฏุงุฒู j ุจุฏู
    // ุจุฎุด ุจุงูโูุงูุฏู
}
```

---

## โ ุจุฑุฑุณ ุตุญุช ุงูฺฏูุฑุชู

### 1. **Mutual Exclusion**

- ุฏุฑ ูุฑ ูุญุธู ููุท ฺฉ ุงุฒ ูพุฑุฏุงุฒูโูุง ูโุชูุงูุฏ ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดูุฏุ ฺุฑุง ฺฉู ููุฏุงุฑ ูุชุบุฑ `turn` ููุท ูโุชูุงูุฏ ฺฉ ุงุฒ ุฏู ููุฏุงุฑ `0` ุง `1` ุฑุง ุฏุงุดุชู ุจุงุดุฏ.
    
- ุงฺฏุฑ `Pแตข` ุฏุงุฎู ุจุฎุด ุจุญุฑุงู ุงุณุชุ ุนู `turn == i`ุ ูพุณ `Pโฑผ` ุจุงุฏ ููุชุธุฑ ุจูุงูุฏ ฺูู `turn != j`.
    

---

### 2. โ **Progress** (ูพุดุฑูุช)

- ุฏุฑ ุงู ุฑุงูโุญูุ ุงูฺฉุงู ุฏุงุฑุฏ ฺฉ ูพุฑุฏุงุฒู ุจู ุตูุฑุช ูุชูุงู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดูุฏ ู ูพุฑุฏุงุฒู ุฏฺฏุฑ ููุชุธุฑ ุจูุงูุฏ ุชุง ููุจุชุด ุจุฑุณุฏ.
    
- ุงูุง ูฺ ุดุฑุท ุจุฑุง **ุงูููุช ุง ุงูุชุฎุงุจ ููุดููุฏุงูู ูพุฑุฏุงุฒูโูุง** ูุฌูุฏ ูุฏุงุฑุฏุ ุจูุงุจุฑุงู ููฺฉู ุงุณุช ุจู ุทูุฑ ูุงุฎูุงุณุชู ูพุดุฑูุช ุฏฺุงุฑ ุงุดฺฉุงู ุดูุฏ.
    

---

### 3. โ **Bounded Waiting** (ุงูุชุธุงุฑ ูุญุฏูุฏ)

- ูฺ ูฺฉุงูุฒู ูุฌูุฏ ูุฏุงุฑุฏ ฺฉู ุชุถูู ฺฉูุฏ ูพุฑุฏุงุฒูโุง ฺฉู ุฏุฑุฎูุงุณุช ูุฑูุฏ ุฏุงุฏูุ ุจุนุฏ ุงุฒ ุญุฏุงฺฉุซุฑ ฺูุฏ ุจุงุฑ ุงุฌุฑุง ุดุฏู ูพุฑุฏุงุฒู ููุงุจู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดูุฏ.
    
- ุจูุงุจุฑุงู ุงูฺฉุงู **Starvation** (ฺฏุฑุณูฺฏ ูพุฑุฏุงุฒู) ูุฌูุฏ ุฏุงุฑุฏ.
    

---

## ๐งพ ุฌูุนโุจูุฏ

|ูฺฺฏ|ูุถุนุช|
|---|---|
|Mutual Exclusion|โ ุจุฑูุฑุงุฑ ุงุณุช|
|Progress|โ๏ธ ููฺฉู ุงุณุช ููุถ ุดูุฏ|
|Bounded Waiting|โ ุจุฑูุฑุงุฑ ูุณุช|

ุงู ุงูฺฏูุฑุชู ุณุงุฏู ู ุดููุฏ ุงุณุชุ ุงูุง ุจุฑุง ุณุณุชูโูุง ูุงูุน ฺฉุงู ูุณุช.

---
# ๐ฉ Flag-Based Algorithm โ ุฑุงูโุญู ุณุงุฏู ุจุฑุง ุฏู ูพุฑุฏุงุฒู

---

## โ๏ธ ุณุงุฎุชุงุฑ ุงูฺฏูุฑุชู

ุงู ุงูฺฏูุฑุชู ูุฒ ุจุฑุง **ุฏู ูพุฑุฏุงุฒู** (Pโ ู Pโ) ุทุฑุงุญ ุดุฏู ุงุณุช.

ุงุฏู ุงุตู ุงู ุงุณุช ฺฉู ูุฑ ูพุฑุฏุงุฒู ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉ **ูพุฑฺู ููุทู (Boolean Flag)** ุงุนูุงู ูโฺฉูุฏ ฺฉู ูุตุฏ ูุฑูุฏ ุจู ุจุฎุด ุจุญุฑุงู ุฑุง ุฏุงุฑุฏ.

---

## ๐งฎ ูุชุบุฑูุง ูุดุชุฑฺฉ

```c
bool flag[2];  // ุจุฑุง ูุฑ ูพุฑุฏุงุฒู ฺฉ ูพุฑฺู (false ุจู ูุนู ุงูฺฉู ูุตุฏ ูุฑูุฏ ูุฏุงุฑุฏ)
````

---

## ๐ ฺฉุฏ ุงูฺฏูุฑุชู ุจุฑุง ูพุฑุฏุงุฒู Pi

```c
while (true) {
    flag[i] = true;            // ุงุนูุงู ุชูุงู ุจู ูุฑูุฏ ุจู ุจุฎุด ุจุญุฑุงู
    while (flag[j]) ;          // ุงฺฏุฑ ูพุฑุฏุงุฒู ุฏฺฏุฑ ูุฒ ูุตุฏ ูุฑูุฏ ุฏุงุดุชู ุจุงุดุฏุ ููุชุธุฑ ุจูุงู
    // --- ุจุฎุด ุจุญุฑุงู ---
    flag[i] = false;           // ุฎุฑูุฌ ุงุฒ ุจุฎุด ุจุญุฑุงู
    // --- ุจุฎุด ุจุงูโูุงูุฏู ---
}
```

---

## โ ุจุฑุฑุณ ูฺฺฏโูุง ุงูฺฏูุฑุชู

### 1. **Mutual Exclusion (ๆโูุงูุน ุจูุฏู)** โ

- ุงฺฏุฑ ูุฑ ุฏู ูพุฑุฏุงุฒู ุจุฎูุงููุฏ ููโุฒูุงู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดููุฏุ ููุท ฺฉ ุงุฒ ุขูโูุง ูโุชูุงูุฏ ูุงุฑุฏ ุดูุฏ. ฺูู ูพุฑุฏุงุฒู ุฏูู ุดุฑุท `while (flag[j])` ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ ู ููุชุธุฑ ูโูุงูุฏ.
    

---

### 2. **Progress (ูพุดุฑูุช)** โ

- ุฏุฑ ุตูุฑุช ฺฉู ูุฑ ุฏู ูพุฑุฏุงุฒู ููโุฒูุงู ููุฏุงุฑ ูพุฑฺู ุฎูุฏ ุฑุง `true` ฺฉููุฏุ ูุฑ ุฏู ูุงุฑุฏ ุญููู `while (flag[j])` ูโุดููุฏ ู **ุฏุฑ ุญุงูุช ุงูุชุธุงุฑ ุจโูพุงุงู (Deadlock) ูโูุงููุฏ**. ูพุณ ุงูฺฏูุฑุชู ุดุฑุท ูพุดุฑูุช ุฑุง ููุถ ูโฺฉูุฏ.
    

---

### 3. **Bounded Waiting (ุงูุชุธุงุฑ ูุญุฏูุฏ)** โ

- ููฺฉู ุงุณุช ูพุฑุฏุงุฒูโุง ุจุงุฑูุง ุชูุงุด ฺฉูุฏ ูุงุฑุฏ ุดูุฏุ ุงูุง ุจู ุฏูู ุนุฏู ฺฉูุชุฑู ููุจุช ุง ุงูููุชุ ููุดู ููุชุธุฑ ุจูุงูุฏ. ูพุณ ุงูุชุธุงุฑ ูุญุฏูุฏ ูู ุจุฑูุฑุงุฑ ูุณุช.
    

---

## ๐งพ ุฌูุนโุจูุฏ

|ูฺฺฏ|ูุถุนุช|
|---|---|
|Mutual Exclusion|โ ุจุฑูุฑุงุฑ ุงุณุช|
|Progress|โ ุงูฺฉุงู ุจูโุจุณุช ูุฌูุฏ ุฏุงุฑุฏ|
|Bounded Waiting|โ ุงูฺฉุงู ฺฏุฑุณูฺฏ ูุฌูุฏ ุฏุงุฑุฏ|

---

## ๐ ูฺฉุชู ููู

> ุงู ุงูฺฏูุฑุชู ุณุงุฏูุ ุดุฑูุน ุฎูุจ ุจุฑุง ุฏุฑฺฉ ููุฒูุงู (Concurrency) ู ฺฉูุชุฑู ุฏุณุชุฑุณ ุจู ููุงุจุน ูุดุชุฑฺฉ ุงุณุชุ ุงูุง ุฏุฑ ุนูู ูุงุจู ุงุทููุงู ูุณุช. ุฑุงูโุญูโูุง ูุงููุฏ **Petersonโs Algorithm** ุง **Mutex** ู **Semaphore**โูุงุ ูุณุฎูโูุง ุจูุจูุฏ ุงูุชู ุขู ูุณุชูุฏ.

---
# ๐ ุฑุงูโุญู ูพุชุฑุณูู (Petersonโs Solution)


## ๐ ูฺฺฏโูุง

Petersonโs Solution ฺฉ ุงูฺฏูุฑุชู ฺฉูุงุณฺฉ ุจุฑุง ุญู ูุณุฆููโ ุจุฎุด ุจุญุฑุงู ุฏุฑ **ุณุณุชูโูุง ุฏุงุฑุง ุฏู ูพุฑุฏุงุฒู (Process)** ุงุณุช.

ุงู ุฑุงูโุญู:
- ุชููุง ุจู **ุฏู ูุชุบุฑ ุงุดุชุฑุงฺฉ** ูุงุฒ ุฏุงุฑุฏ.
- ูุฑุถ ูโฺฉูุฏ ฺฉู ุฏุณุชูุฑุงุช `load` ู `store` ุฏุฑ ุณุทุญ ุณุฎุชโุงูุฒุงุฑ **ุงุชู** ูุณุชูุฏ (ุนู ููโุชูุงููุฏ ุชูุณุท ูพุฑุฏุงุฒูโุง ุฏฺฏุฑ ูุทุน ุดููุฏ).

---

## ๐งฎ ูุชุบุฑูุง ูุดุชุฑฺฉ

```c
int turn;            // ููุจุช ูุฑูุฏ ุจู ุจุฎุด ุจุญุฑุงู
bool flag[2];        // flag[i] = true ุนู Pi ูุตุฏ ูุฑูุฏ ุจู ุจุฎุด ุจุญุฑุงู ุฑุง ุฏุงุฑุฏ
````

---

## ๐จโ๐ป ุงูฺฏูุฑุชู ุจุฑุง ูพุฑุฏุงุฒู Pi

```c
while (true) {
    flag[i] = true;      // ูพุฑุฏุงุฒู i ุชูุงู ุฎูุฏ ุฑุง ุงุนูุงู ูโฺฉูุฏ
    turn = j;            // ููุจุช ุฑุง ุจู ูพุฑุฏุงุฒู ููุงุจู ูโุฏูุฏ

    while (flag[j] && turn == j)
        ;                // ุงฺฏุฑ ูพุฑุฏุงุฒู j ูุฒ ุชูุงู ุฏุงุฑุฏ ู ููุจุช ุงูุณุชุ ููุชุธุฑ ุจูุงู

    // --- ุจุฎุด ุจุญุฑุงู ---

    flag[i] = false;     // ูพุฑุฏุงุฒู i ุงุฒ ุจุฎุด ุจุญุฑุงู ุฎุงุฑุฌ ูโุดูุฏ

    // --- ุจุฎุด ุจุงูโูุงูุฏู ---
}
```

---

## โ ุชุญูู ูฺฺฏโูุง

### 1. Mutual Exclusion (ๆโูุงูุน ุจูุฏู)

- ุงฺฏุฑ ูุฑ ุฏู ูพุฑุฏุงุฒู ุจุฎูุงููุฏ ููโุฒูุงู ูุงุฑุฏ ุดููุฏุ ุชููุง **ฺฉ** ูููู ูโุดูุฏ. ฺูู ุดุฑุท `turn == j` ุจุงุนุซ ูโุดูุฏ ฺฉ ููุชุธุฑ ุจูุงูุฏ.
    

---

### 2. Progress (ูพุดุฑูุช)

- ุงฺฏุฑ ุชููุง ฺฉ ูพุฑุฏุงุฒู ูุตุฏ ูุฑูุฏ ุฏุงุดุชู ุจุงุดุฏุ ููุชุธุฑ ูุฎูุงูุฏ ูุงูุฏ ู ุณุฑุน ูุงุฑุฏ ูโุดูุฏ.
    

---

### 3. Bounded Waiting (ุงูุชุธุงุฑ ูุญุฏูุฏ)

- ููุจุชโูุง ุจู ูพุฑุฏุงุฒูโูุง **ุนุงุฏูุงูู ุชูุณู** ูโุดูุฏุ ู ูุฑ ูพุฑุฏุงุฒู ุฏุฑ ููุงุช ูโุชูุงูุฏ ูุงุฑุฏ ุดูุฏ.
    

---

## โ ูุชุฌูโฺฏุฑ

|ูฺฺฏ|ูุถุนุช|
|---|---|
|Mutual Exclusion|โ ุจุฑูุฑุงุฑ ุงุณุช|
|Progress|โ ุจุฑูุฑุงุฑ ุงุณุช|
|Bounded Waiting|โ ุจุฑูุฑุงุฑ ุงุณุช|

---

## ๐ก ุงุฏุขูุฑ

> ุงูฺฏูุฑุชู ูพุชุฑุณูู ฺฉ ุงุฒ ูุนุฏูุฏ ุฑุงูโุญูโูุง ูุฑูโุงูุฒุงุฑ ุงุณุช ฺฉู ูโุชูุงูุฏ ุจุฏูู ฺฉูฺฉ ุณุฎุชโุงูุฒุงุฑุ ูุณุฆููโ ุจุฎุด ุจุญุฑุงู ุฑุง ุจุฑุง ุฏู ูพุฑุฏุงุฒู ุญู ฺฉูุฏ. ุจุง ุงู ุญุงูุ ุฏุฑ ุณุณุชูโูุง ูุฏุฑู ุจุง ูพุฑุฏุงุฒูุฏูโูุง ฺูุฏ ูุณุชูโุงุ ุงุฒ ุฑูุดโูุง ุณุฎุชโุงูุฒุงุฑ ู ูููโูุง ูพุดุฑูุชูโุชุฑ (ูุงููุฏ Mutex ู Semaphore) ุงุณุชูุงุฏู ูโุดูุฏ.

---
# ๐ฅ๏ธ ุณุฎุชโุงูุฒุงุฑ ููฺฏุงูโุณุงุฒ (Synchronization Hardware)


## ๐ฏ ูุฏู

ุจุณุงุฑ ุงุฒ ุณุณุชูโูุง ุงุฒ **ูพุดุชุจุงู ุณุฎุชโุงูุฒุงุฑ** ุจุฑุง ูพุงุฏูโุณุงุฒ ฺฉุฏ **critical section** ุงุณุชูุงุฏู ูโฺฉููุฏ ุชุง ูุทูุฆู ุดููุฏ ฺฉู ุชููุง ฺฉ ูพุฑุฏุงุฒู ุฏุฑ ูุฑ ุฒูุงู ูโุชูุงูุฏ ุจู ุจุฎุด ุจุญุฑุงู ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏ.

---

## ๐ฑ๏ธ ุณุณุชูโูุง ุชฺฉโูพุฑุฏุงุฒู (Uniprocessors)

- ุฏุฑ ุณุณุชูโูุง **ุชฺฉโูพุฑุฏุงุฒู (Uniprocessor)**ุ ุจุฑุง ุฌููฺฏุฑ ุงุฒ **ูพุดโููุงุทุนู (Preemption)** ูโุชูุงู **ูุทุน ฺฉุฑุฏู (Interrupts)** ุฑุง ุบุฑูุนุงู ฺฉุฑุฏ.
  - ุฏุฑ ุงู ุญุงูุชุ ฺฉุฏ ุฏุฑ ุญุงู ุงุฌุฑุง ุชุง ุงุชูุงู ุงุฌุฑุง ุจุฏูู ูุฏุงุฎูู ุงุฏุงูู ูพุฏุง ูโฺฉูุฏ.
  
- **ูุญุฏูุฏุชโูุง**:
  - ุงู ุฑูุด ุจู ุฏูู **ุนุฏู ููุงุณโูพุฐุฑ** (Scalability) ููุงุณุจ ุจุฑุง ุณุณุชูโูุง ฺูุฏูพุฑุฏุงุฒูโุง (Multiprocessor) ูุณุช.
  - ุณุณุชูโูุง ุนุงูู ฺฉู ุงุฒ ุงู ุฑูุด ุงุณุชูุงุฏู ูโฺฉููุฏุ ูุนูููุงู ุจู ุฎูุจ ููุงุณโูพุฐุฑ ูุณุชูุฏ.

---

## ๐ง ุงููุงุน ูพุดุชุจุงู ุณุฎุชโุงูุฒุงุฑ

### 1. **ุฏุณุชูุฑุงุช ุณุฎุชโุงูุฒุงุฑ (Hardware Instructions)**

- ุจุฑุฎ ุงุฒ ุณุณุชูโูุง ุฏุณุชูุฑุงุช ุฎุงุต ุฏุงุฑูุฏ ฺฉู ุจุฑุง ูพุงุฏูโุณุงุฒ ุนููุงุช ููฺฏุงูโุณุงุฒ ุทุฑุงุญ ุดุฏูโุงูุฏ. ุงู ุฏุณุชูุฑุงุช ูโุชูุงููุฏ ุนููุงุชโูุง ูุงููุฏ **ุชุณุช ู ุชูุธู** (Test and Set) ุง **ุณูุฆฺ ฺฉุฑุฏู ู ุจุณุชู** (Swap) ุฑุง ุงูุฌุงู ุฏููุฏ ุชุง ุฏุณุชุฑุณ ุจู ุจุฎุดโูุง ุจุญุฑุงู ุฑุง ฺฉูุชุฑู ฺฉููุฏ.

### 2. **ูุชุบุฑูุง ุงุชูฺฉ (Atomic Variables)**

- **ูุชุบุฑูุง ุงุชูฺฉ** ุจู ุทูุฑ ุฎุงุต ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุดุฑุงุท ุฑูุงุจุช ุทุฑุงุญ ุดุฏูโุงูุฏ. ุงู ูุชุบุฑูุง ููุท ุชูุณุท ฺฉ ูพุฑุฏุงุฒู ุฏุฑ ฺฉ ุฒูุงู ูุงุจู ุชุบุฑ ูุณุชูุฏ ู ุชุถูู ูโฺฉููุฏ ฺฉู ุชุบุฑุงุช ุจุฑ ุฑู ุขูโูุง ุงุฒ ุฎุงุฑุฌ ูุงุจู ุชุบุฑ ูุจุงุดุฏ.

---

## ๐ ูุชุฌูโฺฏุฑ

- ุงุณุชูุงุฏู ุงุฒ **ูพุดุชุจุงู ุณุฎุชโุงูุฒุงุฑ** ููฺฏุงูโุณุงุฒ ูโุชูุงูุฏ ุงุฒ ุจุฑูุฒ **ูุดฺฉูุงุช ุฑูุงุจุช** ุฏุฑ ุฏุณุชุฑุณ ุจู ููุงุจุน ูุดุชุฑฺฉ ุฌููฺฏุฑ ฺฉูุฏ.
- ุฏุฑ ุณุณุชูโูุง ฺูุฏูพุฑุฏุงุฒูโุงุ ุฑูุดโูุง ูุงููุฏ **ุฏุณุชูุฑุงุช ุณุฎุชโุงูุฒุงุฑ** ู **ูุชุบุฑูุง ุงุชูฺฉ** ูโุชูุงููุฏ ุงุฒ **ููุงูุน ุจูููโุณุงุฒ** ุฌููฺฏุฑ ฺฉููุฏ.
---
# ๐ ูููโูุง ูุชูุงุฑู (Mutex Locks)


## ๐ฏ ูุฏู

ุฑุงูโุญูโูุง ูุจู ุจุฑุง ุญู ูุณุฆูู **critical section** ูพฺุฏู ู ูุนูููุงู ุบุฑูุงุจู ุฏุณุชุฑุณ ุจุฑุง ุจุฑูุงููโููุณุงู ุงูพูฺฉุดู ูุณุชูุฏ.  
ุจุฑุง ุงู ููุธูุฑุ ุทุฑุงุญุงู ุณุณุชูโุนุงูู ุงุจุฒุงุฑูุง ูุฑูโุงูุฒุงุฑ ุจุฑุง ุญู ุงู ูุดฺฉู ุงุฌุงุฏ ฺฉุฑุฏูโุงูุฏ.

---

## ๐งฐ ุณุงุฏูโุชุฑู ุงุจุฒุงุฑ: ููู ูุชูุงุฑู (Mutex Lock)

- **ููู ูุชูุงุฑู (Mutex Lock)**ุ ุณุงุฏูโุชุฑู ุฑุงูโุญู ุงุณุช ฺฉู ุชูุณุท ุทุฑุงุญุงู ุณุณุชูโุนุงูู ูพุงุฏูโุณุงุฒ ูโุดูุฏ.
- ฺฉ ูุชุบุฑ ุจูู (Boolean variable) ูุดุงู ูโุฏูุฏ ฺฉู ุขุง ููู ุฏุฑ ุฏุณุชุฑุณ ุงุณุช ุง ุฎุฑ.

### โ ูุญูู ุนููฺฉุฑุฏ ููู ูุชูุงุฑู

1. **ุฏุฑุงูุช ููู (acquire())**: 
   - ูพุฑุฏุงุฒู ุงุจุชุฏุง ููู ุฑุง **ุฏุฑุงูุช** ูโฺฉูุฏ.
   
2. **ุขุฒุงุฏ ฺฉุฑุฏู ููู (release())**: 
   - ูพุณ ุงุฒ ุงุชูุงู ฺฉุงุฑ ุฏุฑ ุจุฎุด ุจุญุฑุงูุ ููู ุจุงุฏ **ุขุฒุงุฏ** ุดูุฏ.
   
### ๐ ูฺฺฏโูุง:

- **ุฏุฑุงูุช ู ุขุฒุงุฏ ฺฉุฑุฏู ููู ุจุงุฏ ุจู ุตูุฑุช ุงุชูฺฉ** ุงูุฌุงู ุดูุฏ.
- ูุนูููุงู ุงู ุนููุงุช ุจุง ุงุณุชูุงุฏู ุงุฒ ุฏุณุชูุฑูุง ุณุฎุชโุงูุฒุงุฑ ุงุชูฺฉ ูุงููุฏ **ููุงุณู ู ุฌุงฺฏุฒู (compare-and-swap)** ูพุงุฏูโุณุงุฒ ูโุดูุฏ.

---

## โ๏ธ ูุดฺฉู ุงุตู: **ููุชุธุฑ ุจูุฏู ูุดุบูู (Busy Waiting)**

- ุงู ุฑุงูโุญู **ููุชุธุฑ ุจูุฏู ูุดุบูู (Busy Waiting)** ุงุฌุงุฏ ูโฺฉูุฏ.
- ุฒูุงู ฺฉู ูพุฑุฏุงุฒูโุง ูุชูุงูุฏ ููู ุฑุง ุจุฏุณุช ุขูุฑุฏุ ุจุงุฏ ููุชุธุฑ ุจูุงูุฏ ู ุฏุฑ ุญุงู ููุชุธุฑ ุจูุฏูุ **CPU ุฑุง ูุตุฑู ูโฺฉูุฏ**.

---

## ๐ ููู ุงุณูพู (Spinlock)

- ุจู ุฏูู ุงุณุชูุงุฏู ุงุฒ **ููุชุธุฑ ุจูุฏู ูุดุบูู**ุ ุงู ููู ุจู **ููู ุงุณูพู (Spinlock)** ูุนุฑูู ุงุณุช.
- ุฏุฑ ุงู ูููุ ูพุฑุฏุงุฒู ุจู ุทูุฑ ูุฏุงูู ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ููู ุขุฒุงุฏ ุดุฏู ุงุณุช ุง ูู.

---

## ๐ ูุชุฌูโฺฏุฑ

- **ูููโูุง ูุชูุงุฑู** ุฑูุด ุณุงุฏูโุง ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฏุณุชุฑุณ ููุฒูุงู ุจู ุจุฎุด ุจุญุฑุงู ูุณุชูุฏ.
- ุจุง ุงู ุญุงูุ ุงู ุฑูุด ูุงุฒููุฏ **ููุชุธุฑ ุจูุฏู ูุดุบูู** ุงุณุช ฺฉู ููฺฉู ุงุณุช **ฺฉุงุฑุง ุณุณุชู** ุฑุง ุชุญุช ุชุฃุซุฑ ูุฑุงุฑ ุฏูุฏ.

---
# ๐๏ธ ุฑุงูโุญู ูุณุฆูู ุจุฎุด ุจุญุฑุงู ุจุง ุงุณุชูุงุฏู ุงุฒ ูููโูุง ูุชูุงุฑู (Mutex Locks)


## ๐ฏ ูุฏู

ุงุณุชูุงุฏู ุงุฒ **ูููโูุง ูุชูุงุฑู** ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฏุณุชุฑุณ ููุฒูุงู ุจู ุจุฎุด ุจุญุฑุงู ู ุงุทููุงู ุงุฒ ุงูฺฉู ุชููุง ฺฉ ูพุฑุฏุงุฒู ุฏุฑ ูุฑ ุฒูุงู ูโุชูุงูุฏ ุจู ุขู ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏ.

---

## ๐ ุงูฺฏูุฑุชู

ุจุฑุง ุญู ูุดฺฉู **ุจุฎุด ุจุญุฑุงู (Critical Section)** ุจุง ุงุณุชูุงุฏู ุงุฒ ููู ูุชูุงุฑูุ ฺฉ ูพุฑุฏุงุฒู ุจู ุตูุฑุช ูุฏุงูู ุฏุฑ ฺฉ ุญููู ุจู ุฏูุจุงู ููู ูโฺฏุฑุฏุฏ ู ุฒูุงู ฺฉู ููู ุฏุฑ ุฏุณุชุฑุณ ุจุงุดุฏุ ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ูโุดูุฏ.

### โ ฺฉุฏ ูุซุงู:

```c
while (true) {
    acquire(lock);        // ุฏุฑุฎูุงุณุช ููู
    critical_section();    // ุงุฌุฑุง ุจุฎุด ุจุญุฑุงู
    release(lock);        // ุขุฒุงุฏุณุงุฒ ููู
    remainder_section();   // ุงุฌุฑุง ุจุฎุด ุจุงูโูุงูุฏู
}
````

### โ ุชูุถุญุงุช:

- **acquire(lock)**: ูพุฑุฏุงุฒู ุฏุฑุฎูุงุณุช ููู ูโฺฉูุฏ. ุงฺฏุฑ ููู ุขุฒุงุฏ ุจุงุดุฏุ ุขู ุฑุง ุจุฏุณุช ูโุขูุฑุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ููุชุธุฑ ูโูุงูุฏ.
    
- **critical_section()**: ูพุฑุฏุงุฒู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ูโุดูุฏ ู ุนููุงุช ูุฑุจูุทู ุฑุง ุงูุฌุงู ูโุฏูุฏ.
    
- **release(lock)**: ูพุณ ุงุฒ ุงุชูุงู ฺฉุงุฑ ุฏุฑ ุจุฎุด ุจุญุฑุงูุ ููู ุขุฒุงุฏ ูโุดูุฏ ุชุง ุฏฺฏุฑ ูพุฑุฏุงุฒูโูุง ุจุชูุงููุฏ ุงุฒ ุขู ุงุณุชูุงุฏู ฺฉููุฏ.
    
- **remainder_section()**: ูพุฑุฏุงุฒู ุจู ุงูุฌุงู ุณุงุฑ ุนููุงุชโูุง ุบุฑ ุจุญุฑุงู ูโูพุฑุฏุงุฒุฏ.
    

---

## โ๏ธ ูฺฉุงุช ููู:

- **ููุชุธุฑ ุจูุฏู ูุดุบูู (Busy Waiting)**: ุงู ุงูฺฏูุฑุชู ุงุฒ ููุชุธุฑ ุจูุฏู ูุดุบูู ุจุฑุง ุจุฑุฑุณ ุฏุฑ ุฏุณุชุฑุณ ุจูุฏู ููู ุงุณุชูุงุฏู ูโฺฉูุฏ.
    
- ุงู ููฺฉู ุงุณุช ุจุงุนุซ **ุงุชูุงู ููุงุจุน ุณุณุชู** ุจู ูฺู ุฏุฑ ุดุฑุงุท ุจุง ุชุนุฏุงุฏ ูพุฑุฏุงุฒูโูุง ุฒุงุฏ ุดูุฏ.
    

---

## ๐ ูุชุฌูโฺฏุฑ

ุงุณุชูุงุฏู ุงุฒ **ูููโูุง ูุชูุงุฑู (Mutex Locks)** ฺฉ ุงุฒ ุณุงุฏูโุชุฑู ุฑูุดโูุง ุจุฑุง ุญู ูุดฺฉู ุฏุณุชุฑุณ ููุฒูุงู ุจู ุจุฎุด ุจุญุฑุงู ุงุณุชุ ุงูุง ุจุงุฏ ูุฑุงูุจ **ุงุชูุงู ููุงุจุน** ูุงุด ุงุฒ ููุชุธุฑ ุจูุฏู ูุดุบูู ุจุงุดู.

---
# ๐ป ุฑุงูโุญู ูุจุชู ุจุฑ ููููโูุง (Interrupt-based Solution)

## ๐ฏ ูุฏู

ุฏุฑ ุงู ุฑูุดุ ุจุฑุง ุญู ูุณุฆูู **ุฏุณุชุฑุณ ููุฒูุงู ุจู ุจุฎุด ุจุญุฑุงู**ุ ุงุฒ ููููโูุง ุงุณุชูุงุฏู ูโุดูุฏ.

---

## ๐ ุจุฎุดโูุง ุงุตู:

- **ุจุฎุด ูุฑูุฏ (Entry Section)**: ููููโูุง ุบุฑูุนุงู ูโุดููุฏ ุชุง ูพุฑุฏุงุฒู ุฏุฑ ููฺฏุงู ุฏุณุชุฑุณ ุจู ุจุฎุด ุจุญุฑุงู ููุฑุฏ ูพุดโููุงุทุนู ูุฑุงุฑ ูฺฏุฑุฏ.
- **ุจุฎุด ุฎุฑูุฌ (Exit Section)**: ูพุณ ุงุฒ ุงุชูุงู ฺฉุงุฑ ุฏุฑ ุจุฎุด ุจุญุฑุงูุ ููููโูุง ุฏูุจุงุฑู ูุนุงู ูโุดููุฏ.

---

## โ๏ธ ุขุง ุงู ุฑุงูโุญู ูุดฺฉู ุฑุง ุญู ูโฺฉูุฏุ

1. **ุงฺฏุฑ ุจุฎุด ุจุญุฑุงู ูุฏุช ุฒูุงู ุฒุงุฏ (ูุซู ฺฉ ุณุงุนุช) ุทูู ุจฺฉุดุฏุ ุขุง ุงู ุฑุงูโุญู ฺฉุงุฑุขูุฏ ุฎูุงูุฏ ุจูุฏุ**
   - ุงฺฏุฑ ฺฉุฏ ุจุฎุด ุจุญุฑุงู ุฒูุงู ุฒุงุฏ ุทูู ุจฺฉุดุฏุ ุงุณุชูุงุฏู ุงุฒ ุงู ุฑูุด ููุฌุฑ ุจู **ุงุชูุงู ุทููุงู ูุฏุช ููุงุจุน** ูโุดูุฏ ู ูพุฑุฏุงุฒูโูุง ุฏฺฏุฑ ููโุชูุงููุฏ ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดููุฏ.

2. **ุขุง ููฺฉู ุงุณุช ุจุฑุฎ ูพุฑุฏุงุฒูโูุง ูฺโฺฏุงู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุฎูุฏ ูุดููุฏุ**
   - ุจููุ ุงฺฏุฑ ูพุฑุฏุงุฒูโุง ูุชูุงูุฏ ุจู ูููุน ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดูุฏุ ููฺฉู ุงุณุช ุจู ุฏูู ุบุฑูุนุงู ุจูุฏู ููููโูุงุ **ุจู ุทูุฑ ุฏุงุฆู ููุชุธุฑ ุจูุงูุฏ**.

3. **ุงฺฏุฑ ุณุณุชู ุฏุงุฑุง ุฏู ูพุฑุฏุงุฒูุฏู ุจุงุดุฏุ ุขุง ุงู ุฑุงูโุญู ฺฉุงุฑ ูโฺฉูุฏุ**
   - ุฏุฑ ุณุณุชูโูุง ฺูุฏูพุฑุฏุงุฒูโุง (Multiprocessor)ุ ุบุฑูุนุงู ฺฉุฑุฏู ููููโูุง ุจู ุทูุฑ ฺฉุงูู ุฑู ูุฑ ูพุฑุฏุงุฒูุฏู **ูุคุซุฑ ูุฎูุงูุฏ ุจูุฏ**. ุงู ุฑุงูโุญู ุจุฑุง ุณุณุชูโูุง ุชฺฉโูพุฑุฏุงุฒูโุง ููุงุณุจ ุงุณุชุ ุงูุง ุจุฑุง ุณุณุชูโูุง ฺูุฏูพุฑุฏุงุฒูโุง ููโุชูุงูุฏ ุงุทููุงู ุฏูุฏ ฺฉู ุชููุง ฺฉ ูพุฑุฏุงุฒู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดูุฏ.

---

# ๐๏ธ ุฏุณุชูุฑุงุช ุณุฎุชโุงูุฒุงุฑ (Hardware Instructions)

ุจุฑุง ุญู ูุณุฆูู **ุฏุณุชุฑุณ ููุฒูุงู** ู ุฌููฺฏุฑ ุงุฒ ูุดฺฉูุงุช ูุงููุฏ **ููุชุธุฑ ุจูุฏู ูุดุบูู** ุง **ุงุชูุงู ููุงุจุน**ุ ุงุฒ ุฏุณุชูุฑุงุช ุณุฎุชโุงูุฒุงุฑ ุงุณุชูุงุฏู ูโุดูุฏ ฺฉู ุจู ุตูุฑุช ุงุชูฺฉ ู ุจุฏูู ูููู ุนูู ูโฺฉููุฏ.

### โ ุฏุณุชูุฑุงุช ุงุตู:

1. **Test-and-Set**:
   - ุงู ุฏุณุชูุฑ ฺฉ ฺฉููู ุญุงูุธู ุฑุง ุชุณุช ู ุชุบุฑ ูโุฏูุฏ ุจู ุตูุฑุช ุงุชูฺฉ.
   
2. **Compare-and-Swap**:
   - ุงู ุฏุณุชูุฑ ุจู ุตูุฑุช ุงุชูฺฉ ุฏู ฺฉููู ุฑุง ููุงุณู ฺฉุฑุฏู ู ุฏุฑ ุตูุฑุช ุชุทุงุจูุ ูุญุชูุง ุขูโูุง ุฑุง ุฌุงุจุฌุง ูโฺฉูุฏ.

ุงู ุฏุณุชูุฑุงุช ุจู ุณุณุชู ฺฉูฺฉ ูโฺฉููุฏ ุชุง ุนููุงุชโูุง ุฏุณุชุฑุณ ุจู ุจุฎุด ุจุญุฑุงู ุจู ุตูุฑุช **ุงุชู** ุงูุฌุงู ุดููุฏุ ุจุฏูู ุงูฺฉู ูุงุฒ ุจู ููุชุธุฑ ุจูุฏู ูุดุบูู ุจุงุดุฏ.

---

## ๐ ูุชุฌูโฺฏุฑ

- ุงุณุชูุงุฏู ุงุฒ **ุบุฑูุนุงู ฺฉุฑุฏู ููููโูุง** ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูพุดโููุงุทุนูุ ููฺฉู ุงุณุช ุฏุฑ ุณุณุชูโูุง ุชฺฉโูพุฑุฏุงุฒูโุง ููุฏ ุจุงุดุฏุ ุงูุง ุฏุฑ ุณุณุชูโูุง ฺูุฏูพุฑุฏุงุฒูโุง ูุดฺฉูุงุช ุจู ูุฌูุฏ ูโุขุฏ.
- ุจุฑุง ุญู ุงู ูุดฺฉูุงุชุ ุฏุณุชูุฑุงุช **Test-and-Set** ู **Compare-and-Swap** ุจุฑุง ุงุทููุงู ุงุฒ **ุฏุณุชุฑุณโูพุฐุฑ ุจู ุจุฎุด ุจุญุฑุงู ุจู ุตูุฑุช ุงุชูฺฉ** ุงุณุชูุงุฏู ูโุดููุฏ.


---

# ๐ ุฏุณุชูุฑ **test_and_set**


## ๐ฏ ุชุนุฑู ุฏุณุชูุฑ **test_and_set**

ุฏุณุชูุฑ **test_and_set** ฺฉ ุฏุณุชูุฑ ุงุชูฺฉ ุงุณุช ฺฉู ฺฉ ูุชุบุฑ ุจูู ุฑุง ุจุฑุฑุณ ฺฉุฑุฏู ู ููุฏุงุฑ ุฌุฏุฏ ุขู ุฑุง ุจู `true` ุชุบุฑ ูโุฏูุฏ. ุงู ุฏุณุชูุฑ ููุฒูุงูุ ุจุฏูู ูููู ู ุจูโุทูุฑ ุงุชูฺฉ ุงุฌุฑุง ูโุดูุฏ.

### โ ุชุนุฑู:

```c
boolean test_and_set (boolean *target) {
    boolean rv = *target;
    *target = true;
    return rv;
}
````

- **rv**: ููุฏุงุฑ ุงุตู ูุชุบุฑ ูุฑูุฏ `*target` ุฑุง ุฐุฎุฑู ูโฺฉูุฏ.
    
- ููุฏุงุฑ `*target` ุจู `true` ุชุบุฑ ูโุงุจุฏ.
    
- ุฏุฑ ููุงุชุ ููุฏุงุฑ ุงููู `*target` (ูุจู ุงุฒ ุชุบุฑ) ุจุงุฒฺฏุดุช ุฏุงุฏู ูโุดูุฏ.
    

---

## โ๏ธ ูฺฺฏโูุง ู ุฎุตูุตุงุช ุฏุณุชูุฑ **test_and_set**

- **ุงุฌุฑุง ุจูโุตูุฑุช ุงุชูฺฉ**: ุนู ุงู ุฏุณุชูุฑ ุจู ุทูุฑ ฺฉุงูู ุงุฌุฑุง ูโุดูุฏ ู ูฺ ูพุฑุฏุงุฒู ุฏฺฏุฑ ููโุชูุงูุฏ ุฏุฑ ุญู ุงุฌุฑุง ุขู ูุงุฑุฏ ุนูู ุดูุฏ.
    
- **ููุฏุงุฑ ุจุงุฒฺฏุดุช**: ููุฏุงุฑ ุงุตู ูุชุบุฑ ูุฑูุฏ ูุจู ุงุฒ ุชุบุฑ ุจู `true` ุจุงุฒฺฏุดุช ุฏุงุฏู ูโุดูุฏ.
    
- **ุชุบุฑ ููุฏุงุฑ**: ูพุณ ุงุฒ ุงุฌุฑุง ุฏุณุชูุฑุ ููุฏุงุฑ ูุชุบุฑ ุจู `true` ุชุบุฑ ูโฺฉูุฏ.
    

---

# ๐ก ุฑุงูโุญู ุจุง ุงุณุชูุงุฏู ุงุฒ **test_and_set()**

ุฏุฑ ุงู ุฑูุดุ ุงุฒ ฺฉ ูุชุบุฑ ุจูู ุจู ูุงู `lock` ุงุณุชูุงุฏู ูโุดูุฏ ฺฉู ุจู ุทูุฑ ูุดุชุฑฺฉ ุฏุฑ ูุงู ูพุฑุฏุงุฒูโูุง ูุฑุงุฑ ูโฺฏุฑุฏ. ุงู ูุชุบุฑ ุงุจุชุฏุง ุจู ููุฏุงุฑ `false` ุชูุธู ูโุดูุฏ.

### โ ุฑุงูโุญู:

```c
do {
    while (test_and_set(&lock))
        ; /* do nothing */
    /* critical section */
    lock = false;
    /* remainder section */
} while (true);
```

1. ูพุฑุฏุงุฒู ุงุจุชุฏุง ุจูโุทูุฑ ูุฏุงูู ุงุฒ **test_and_set** ุจุฑุง ุจุฑุฑุณ ููู ุงุณุชูุงุฏู ูโฺฉูุฏ.
    
2. ุงฺฏุฑ ููู ุฏุฑ ุฏุณุชุฑุณ ูุจุงุดุฏ (`test_and_set(&lock)` ููุฏุงุฑ `true` ุจุงุฒ ูโฺฏุฑุฏุงูุฏ)ุ ูพุฑุฏุงุฒู ุฏุฑ ุญุงูุช **ููุชุธุฑ ุจูุฏู ูุดุบูู (busy waiting)** ูโูุงูุฏ.
    
3. ููฺฏุงู ฺฉู ููู ุขุฒุงุฏ ูโุดูุฏุ ูพุฑุฏุงุฒู ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดุฏู ู ูพุณ ุงุฒ ุงุชูุงู ฺฉุงุฑุ ููู ุฑุง ุขุฒุงุฏ ูโฺฉูุฏ.
    

---

## โ๏ธ ุขุง ุงู ุฑุงูโุญู ูุณุฆูู ุจุฎุด ุจุญุฑุงู ุฑุง ุญู ูโฺฉูุฏุ

### โ ูุดฺฉูุงุช ุงู ุฑุงูโุญู:

1. **ููุชุธุฑ ุจูุฏู ูุดุบูู (Busy Waiting)**:
    
    - ูพุฑุฏุงุฒูโูุง ุจุงุฏ ุจุฑุง ุฏุฑุงูุช ููู ุฏุฑ ุญุงูุช **ููุชุธุฑ ุจูุฏู ูุดุบูู** ุจูุงููุฏ ฺฉู ุจุงุนุซ **ุงุชูุงู ููุงุจุน** ูโุดูุฏ. ุงู ุฑูุด ููฺฉู ุงุณุช ฺฉุงุฑุง ุณุณุชู ุฑุง ูพุงู ุขูุฑุฏ.
        
2. **Starvation**:
    
    - ุงฺฏุฑ ุชุนุฏุงุฏ ูพุฑุฏุงุฒู ูููุงุฑู ุฏุฑ ุชูุงุด ุจุฑุง ุฏุฑุงูุช ููู ุจุงุดูุฏุ ููฺฉู ุงุณุช ุจุฑุฎ ุงุฒ ุขูโูุง ูฺโฺฏุงู ูุชูุงููุฏ ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ุดููุฏ ู ุจู ุงุตุทูุงุญ ุฏฺุงุฑ **ฺฏุฑุณูฺฏ (Starvation)** ุดููุฏ.
        
3. **ููุงุณโูพุฐุฑ ุฏุฑ ุณุณุชูโูุง ฺูุฏูพุฑุฏุงุฒูโุง (Multiprocessor)**:
    
    - ุฏุฑ ุณุณุชูโูุง ฺูุฏูพุฑุฏุงุฒูโุงุ ุงู ุฑูุด ููฺฉู ุงุณุช ูุดฺฉูุงุช ุงุฌุงุฏ ฺฉูุฏุ ุฒุฑุง **ุฏุฑ ูุฑ ูพุฑุฏุงุฒูุฏู** ุนููุงุช `test_and_set` ุจู ุตูุฑุช ุงุชูฺฉ ุงูุฌุงู ูโุดูุฏุ ุงูุง ุงุฒ ุขูุฌุง ฺฉู ููู ูพุฑุฏุงุฒูโูุง ููฺฉู ุงุณุช ุจุฑ ุฑู ููุงุจุน ูุดุชุฑฺฉ ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏุ ููฺฉู ุงุณุช ุจุฑุฎ ุงุฒ ูพุฑุฏุงุฒูโูุง ุจู ุตูุฑุช ุฏุงุฆู ููุชุธุฑ ุจูุงููุฏ.
        

---

## ๐ ูุชุฌูโฺฏุฑ

ุฏุณุชูุฑ **test_and_set** ฺฉ ุงุฒ ุฑูุดโูุง ุฑุงุฌ ุจุฑุง ูพุงุฏูโุณุงุฒ **ูููโูุง** ุฏุฑ ุจุฎุดโูุง ุจุญุฑุงู ุงุณุช. ุงู ุฑูุด ุงุฒ ูฺฺฏโูุง ุงุชูฺฉ ุจูุฏู ุจูุฑู ูโุจุฑุฏุ ุงูุง ุจู ุฏูู **ููุชุธุฑ ุจูุฏู ูุดุบูู** ู **ฺฏุฑุณูฺฏ ูพุฑุฏุงุฒูโูุง** ููฺฉู ุงุณุช ฺฉุงุฑุง ุณุณุชู ุฑุง ุชุญุช ุชุฃุซุฑ ูุฑุงุฑ ุฏูุฏ.

---

# ๐ ุฏุณุชูุฑ **compare_and_swap**


## ๐ฏ ุชุนุฑู ุฏุณุชูุฑ **compare_and_swap**

ุฏุณุชูุฑ **compare_and_swap** ฺฉ ุฏุณุชูุฑ ุงุชูฺฉ ุงุณุช ฺฉู ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ฺฉ ููุฏุงุฑ ุฑุง ุจุง ฺฉ ุดุฑุท ุฎุงุต ุชุบุฑ ุฏูุฏ. ุงู ุฏุณุชูุฑ ููุฏุงุฑ ูุฑูุฏ ุฑุง ููุงุณู ฺฉุฑุฏู ู ุฏุฑ ุตูุฑุช ฺฉู ููุฏุงุฑ ูุชุบุฑ ุจุฑุงุจุฑ ุจุง ููุฏุงุฑ ููุฑุฏ ุงูุชุธุงุฑ ุจุงุดุฏุ ุขู ุฑุง ุจุง ููุฏุงุฑ ุฌุฏุฏ ุฌุงฺฏุฒู ูโฺฉูุฏ.

### โ ุชุนุฑู:

```c
int compare_and_swap(int *value, int expected, int new_value) {
    int temp = *value;
    if (*value == expected)
        *value = new_value;
    return temp;
}
````

- **value**: ุขุฏุฑุณ ูุชุบุฑ ฺฉู ุจุงุฏ ุชุบุฑ ฺฉูุฏ.
    
- **expected**: ููุฏุงุฑ ฺฉู ูโุฎูุงูู ุจุง ุขู ููุงุณู ฺฉูู.
    
- **new_value**: ููุฏุงุฑ ฺฉู ุจุงุฏ ุจู ูุชุบุฑ `value` ุชุฎุตุต ุฏุงุฏู ุดูุฏ ุฏุฑ ุตูุฑุช ฺฉู ููุฏุงุฑ ูุนู ุจุฑุงุจุฑ ุจุง `expected` ุจุงุดุฏ.
    

---

## โ๏ธ ูฺฺฏโูุง ู ุฎุตูุตุงุช ุฏุณุชูุฑ **compare_and_swap**

- **ุงุฌุฑุง ุจูโุตูุฑุช ุงุชูฺฉ**: ุงู ุฏุณุชูุฑ ุจู ุทูุฑ ฺฉุงูู ู ุจุฏูู ูููู ุงุฌุฑุง ูโุดูุฏ.
    
- **ููุฏุงุฑ ุจุงุฒฺฏุดุช**: ููุฏุงุฑ ุงุตู ูุชุบุฑ ูุฑูุฏ **value** ูุจู ุงุฒ ุชุบุฑ ุจู `new_value` ุจุงุฒฺฏุดุช ุฏุงุฏู ูโุดูุฏ.
    
- **ุดุฑุท ุชุบุฑ**: ุชุบุฑ ููุฏุงุฑ ูุชุบุฑ ุชููุง ุฒูุงู ุงูุฌุงู ูโุดูุฏ ฺฉู ููุฏุงุฑ ูุนู **value** ุจุฑุงุจุฑ ุจุง **expected** ุจุงุดุฏ.
    

---

# ๐ก ุฑุงูโุญู ุจุง ุงุณุชูุงุฏู ุงุฒ **compare_and_swap**

ุฏุฑ ุงู ุฑูุดุ ุงุฒ ฺฉ ูุชุบุฑ **lock** ุจู ุนููุงู ููู ุงุณุชูุงุฏู ูโุดูุฏ. ุงู ูุชุบุฑ ุงุจุชุฏุง ุจู ููุฏุงุฑ ฐ (ููู ุขุฒุงุฏ) ุชูุธู ูโุดูุฏ.

### โ ุฑุงูโุญู:

```c
while (true) {
    while (compare_and_swap(&lock, 0, 1) != 0)
        ; /* do nothing */
    /* critical section */
    lock = 0;
    /* remainder section */
}
```

1. **`compare_and_swap(&lock, 0, 1)`**: ุงุจุชุฏุง ูพุฑุฏุงุฒู ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ููุฏุงุฑ `lock` ุจุฑุงุจุฑ ุจุง ฐ ุงุณุช (ููู ุขุฒุงุฏ ุงุณุช). ุงฺฏุฑ ุจููุ ุขู ุฑุง ุจู ฑ ุชุบุฑ ูโุฏูุฏ (ููู ุฑุง ูโฺฏุฑุฏ).
    
2. ุงฺฏุฑ ููุฏุงุฑ `lock` ุจุฑุงุจุฑ ุจุง ฐ ูุจุงุดุฏุ ูพุฑุฏุงุฒู ูุงุฑุฏ **ููุชุธุฑ ุจูุฏู ูุดุบูู (busy waiting)** ูโุดูุฏ ู ุชุง ุฒูุงู ุขุฒุงุฏ ุดุฏู ููู ููุชุธุฑ ูโูุงูุฏ.
    
3. ูพุณ ุงุฒ ุงุชูุงู ุจุฎุด ุจุญุฑุงูุ ููู ุขุฒุงุฏ ูโุดูุฏ (`lock = 0`).
    

---

## โ๏ธ ุขุง ุงู ุฑุงูโุญู ูุณุฆูู ุจุฎุด ุจุญุฑุงู ุฑุง ุญู ูโฺฉูุฏุ

### โ ูุดฺฉูุงุช ู ูฺฉุงุช:

1. **ููุชุธุฑ ุจูุฏู ูุดุบูู (Busy Waiting)**:
    
    - ููุงููุฏ ุฏุณุชูุฑ **test_and_set**ุ ุงู ุฑูุด ูุฒ ุงุฒ **ููุชุธุฑ ุจูุฏู ูุดุบูู** ุงุณุชูุงุฏู ูโฺฉูุฏ ฺฉู ููฺฉู ุงุณุช ุจุงุนุซ **ุงุชูุงู ููุงุจุน** ุดูุฏ.
        
2. **Starvation (ฺฏุฑุณูฺฏ ูพุฑุฏุงุฒูโูุง)**:
    
    - ุฏุฑ ุตูุฑุช ฺฉู ูพุฑุฏุงุฒูโูุง ุจูโุทูุฑ ูุฏุงูู ูุชูุงููุฏ ููู ุฑุง ุจุฏุณุช ุขูุฑูุฏุ ููฺฉู ุงุณุช ุจุฑุฎ ุงุฒ ูพุฑุฏุงุฒูโูุง **ูฺโฺฏุงู** ูุงุฑุฏ ุจุฎุด ุจุญุฑุงู ูุดููุฏ (ฺฏุฑุณูฺฏ).
        
3. **ููุงุณโูพุฐุฑ**:
    
    - ุงู ุฑูุด ููฺฉู ุงุณุช ุฏุฑ ุณุณุชูโูุง **ฺูุฏูพุฑุฏุงุฒูโุง (Multiprocessor)** ูุดฺฉูุงุช ุงุฌุงุฏ ฺฉูุฏุ ุฒุฑุง ุชูุงู ูพุฑุฏุงุฒูโูุง ุงุฒ ููู ููู ุจุฑุง ุฏุณุชุฑุณ ุจู ุจุฎุด ุจุญุฑุงู ุงุณุชูุงุฏู ูโฺฉููุฏ.
        

---

## ๐ ูุชุฌูโฺฏุฑ

ุฏุณุชูุฑ **compare_and_swap** ฺฉ ุฑูุด ุงุชูฺฉ ุงุณุช ฺฉู ุจุฑุง ุญู ูุณุฆูู **ุฏุณุชุฑุณ ููุฒูุงู ุจู ุจุฎุด ุจุญุฑุงู** ุงุณุชูุงุฏู ูโุดูุฏ. ุงู ุฏุณุชูุฑ ูโุชูุงูุฏ ุจู ุญู ุจุณุงุฑ ุงุฒ ูุดฺฉูุงุช ูุฑุจูุท ุจู ุฏุณุชุฑุณ ุจู ููุงุจุน ูุดุชุฑฺฉ ฺฉูฺฉ ฺฉูุฏุ ุงูุง ููฺูุงู ุจู ุฏูู **ููุชุธุฑ ุจูุฏู ูุดุบูู** ู **ฺฏุฑุณูฺฏ ูพุฑุฏุงุฒูโูุง** ููฺฉู ุงุณุช ุฏุฑ ุดุฑุงุท ุฎุงุต ฺฉุงุฑุง ุณุณุชู ุฑุง ุชุญุช ุชุฃุซุฑ ูุฑุงุฑ ุฏูุฏ.

---
